"use strict";(self["webpackChunkel_ciruelo_app_web"]=self["webpackChunkel_ciruelo_app_web"]||[]).push([[509],{2509:function(t,e,a){a.r(e),a.d(e,{default:function(){return A}});var o=a(6768);function r(t,e,a,r,n,c){const i=(0,o.g2)("Ventas");return(0,o.uX)(),(0,o.Wv)(i)}a(8111),a(1701);var n=a(5130),c=a(4232);const i={class:"container"},d={class:"form-group"},l={class:"form-group"},s={class:"form-group"},u={class:"form-actions"},p=["disabled"],h={key:0,class:"sin-productos"},v={key:1},b=["onClick"],g={key:2,class:"paginacion"},m=["disabled"],k=["onClick"],V=["disabled"],P={key:3,class:"info-paginacion"};function f(t,e,a,r,f,y){const L=(0,o.g2)("q-select");return(0,o.uX)(),(0,o.CE)("div",i,[e[10]||(e[10]=(0,o.Lk)("h2",null,"Ventas",-1)),(0,o.Lk)("form",{class:"form-venta",onSubmit:e[3]||(e[3]=(0,n.D$)((...t)=>y.agregarVenta&&y.agregarVenta(...t),["prevent"]))},[(0,o.Lk)("div",d,[e[6]||(e[6]=(0,o.Lk)("label",{for:"productoNombre"},"Producto",-1)),(0,o.bF)(L,{modelValue:f.productoSeleccionado,"onUpdate:modelValue":[e[0]||(e[0]=t=>f.productoSeleccionado=t),y.onProductoSeleccionado],"use-input":"","input-debounce":"300",onFilter:y.filtrarProductos,"option-label":"nombre","option-value":"id","map-options":"",placeholder:f.productoSeleccionado?"":f.qSelectPlaceholder,loading:f.cargandoProductos,clearable:"",options:f.productosFiltrados.map(t=>({...t,label:`${t.nombre} (${t.marca})`}))},null,8,["modelValue","onFilter","placeholder","loading","onUpdate:modelValue","options"])]),(0,o.Lk)("div",l,[e[7]||(e[7]=(0,o.Lk)("label",{for:"cantidad"},"Cantidad",-1)),(0,o.bo)((0,o.Lk)("input",{id:"cantidad","onUpdate:modelValue":e[1]||(e[1]=t=>f.nuevaVenta.cantidad=t),type:"number",min:"1",placeholder:"Cantidad",required:""},null,512),[[n.Jo,f.nuevaVenta.cantidad,void 0,{number:!0}]])]),(0,o.Lk)("div",s,[e[8]||(e[8]=(0,o.Lk)("label",{for:"precio"},"Precio unitario",-1)),(0,o.bo)((0,o.Lk)("input",{id:"precio","onUpdate:modelValue":e[2]||(e[2]=t=>f.nuevaVenta.precio=t),type:"number",min:"0",step:"0.01",placeholder:"Precio unitario",readonly:"",required:""},null,512),[[n.Jo,f.nuevaVenta.precio,void 0,{number:!0}]])]),(0,o.Lk)("div",u,[(0,o.Lk)("button",{type:"submit",disabled:!f.nuevaVenta.productoId}," Agregar Venta ",8,p)])],32),0===f.ventas.length?((0,o.uX)(),(0,o.CE)("div",h," No hay ventas registradas. ")):((0,o.uX)(),(0,o.CE)("table",v,[e[9]||(e[9]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"#"),(0,o.Lk)("th",null,"Producto"),(0,o.Lk)("th",null,"Cantidad"),(0,o.Lk)("th",null,"Precio"),(0,o.Lk)("th",null,"Subtotal"),(0,o.Lk)("th",null,"Acciones")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(y.ventasPaginadas,(t,e)=>((0,o.uX)(),(0,o.CE)("tr",{key:e},[(0,o.Lk)("td",null,(0,c.v_)(e+1+y.inicio),1),(0,o.Lk)("td",null,(0,c.v_)(t.productoNombre||t.detalles&&t.detalles[0]?.productoNombre),1),(0,o.Lk)("td",null,(0,c.v_)(t.cantidad||t.detalles&&t.detalles[0]?.cantidad),1),(0,o.Lk)("td",null,"$"+(0,c.v_)((t.precio||t.detalles?.[0]?.precioUnitario||0).toFixed(2)),1),(0,o.Lk)("td",null,"$"+(0,c.v_)(((t.cantidad||t.detalles?.[0]?.cantidad||0)*(t.precio||t.detalles?.[0]?.precioUnitario||0)).toFixed(2)),1),(0,o.Lk)("td",null,[(0,o.Lk)("button",{onClick:t=>y.eliminarVenta(e+y.inicio)},"Eliminar",8,b)])]))),128))])])),y.totalPages>1?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.Lk)("button",{disabled:1===f.currentPage,onClick:e[4]||(e[4]=t=>y.cambiarPagina(f.currentPage-1))},"Anterior",8,m),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(y.totalPages,t=>((0,o.uX)(),(0,o.CE)("button",{key:t,class:(0,c.C4)({activo:t===f.currentPage}),onClick:e=>y.cambiarPagina(t)},(0,c.v_)(t),11,k))),128)),(0,o.Lk)("button",{disabled:f.currentPage===y.totalPages,onClick:e[5]||(e[5]=t=>y.cambiarPagina(f.currentPage+1))},"Siguiente",8,V)])):(0,o.Q3)("",!0),f.ventas.length?((0,o.uX)(),(0,o.CE)("div",P," Mostrando registros del "+(0,c.v_)(y.inicio+1)+" al "+(0,c.v_)(y.fin)+" de un total de "+(0,c.v_)(f.ventas.length)+" registros ",1)):(0,o.Q3)("",!0)])}a(4114);var y=a(3460),L=a(5763),S=a(8199),C={components:{QSelect:S.Sic,QInput:S.ieb},data(){return{ventas:[],productosFiltrados:[],cargandoProductos:!1,qSelectPlaceholder:"Escribe para buscar producto",nuevaVenta:{productoId:null,productoNombre:"",cantidad:1,precio:0},productoSeleccionado:null,currentPage:1,pageSize:10}},computed:{totalPages(){return Math.ceil(this.ventas.length/this.pageSize)},ventasPaginadas(){const t=(this.currentPage-1)*this.pageSize;return this.ventas.slice(t,t+this.pageSize)},inicio(){return(this.currentPage-1)*this.pageSize},fin(){return Math.min(this.inicio+this.pageSize,this.ventas.length)}},methods:{async filtrarProductos(t,e,a){if(!t||t.length<2)e(()=>{this.productosFiltrados=[]});else{this.cargandoProductos=!0;try{const a=await(0,y.vU)(t);e(()=>{this.productosFiltrados=a})}catch(o){console.error("Error buscando productos:",o),e(()=>{this.productosFiltrados=[]})}finally{this.cargandoProductos=!1}}},onProductoSeleccionado(t){t?(this.nuevaVenta.productoId=t.id,this.nuevaVenta.productoNombre=t.nombre,this.nuevaVenta.productoMarca=t.marca,this.nuevaVenta.precio=t.precioVenta,this.textoBusquedaProducto=t.nombre):(this.nuevaVenta={productoId:null,productoNombre:"",productoMarca:"",cantidad:1,precio:0},this.textoBusquedaProducto="")},async agregarVenta(){if(!this.nuevaVenta.productoId)return void alert("Selecciona un producto válido");const t={fecha:(new Date).toISOString().slice(0,19),total:this.nuevaVenta.cantidad*this.nuevaVenta.precio,detalles:[{productoId:this.nuevaVenta.productoId,productoNombre:this.nuevaVenta.productoNombre,productoMarca:this.nuevaVenta.productoMarca,cantidad:this.nuevaVenta.cantidad,precioUnitario:this.nuevaVenta.precio,subtotal:this.nuevaVenta.cantidad*this.nuevaVenta.precio}]};console.log("Payload enviado:",t);try{const e=await L.A.crearVenta(t);console.log("Respuesta del backend:",e),this.ventas.push({productoNombre:this.nuevaVenta.productoNombre,cantidad:this.nuevaVenta.cantidad,precio:this.nuevaVenta.precio}),this.productoSeleccionado=null,this.nuevaVenta={productoId:null,productoNombre:"",productoMarca:"",cantidad:1,precio:0}}catch(e){console.error("Error completo al crear venta:",e),e.response&&(console.error("Código HTTP:",e.response.status),console.error("Body de la respuesta:",e.response.data)),alert("Error al crear la venta, revisa consola.")}},cambiarPagina(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)},eliminarVenta(t){this.ventas.splice(t,1)}},async mounted(){try{const t=await L.A.obtenerTodasLasVentas();this.ventas=t.data.map(t=>{if(t.detalles&&t.detalles.length>0){const e=t.detalles[0];return{productoNombre:e.productoNombre,cantidad:e.cantidad,precio:e.precioUnitario,...t}}return t})}catch(t){console.error("Error al cargar ventas:",t)}}},E=a(1241);const w=(0,E.A)(C,[["render",f],["__scopeId","data-v-fbdce67e"]]);var _=w,N={components:{Ventas:_}};const I=(0,E.A)(N,[["render",r]]);var A=I},3460:function(t,e,a){a.d(e,{h$:function(){return n},mh:function(){return i},sb:function(){return d},vU:function(){return l},yl:function(){return c}});var o=a(4373);const r="http://localhost:8081/facturacion/v1.1/productos",n=async t=>{try{const e=await o.A.post(r,t);return e.data}catch(e){throw console.error("Error guardando producto:",e),e}},c=async(t,e)=>{try{const a=await o.A.put(`${r}/${e}`,t);return a.data}catch(a){throw console.error("Error actualizando producto:",a),a}},i=async t=>{try{const e=await o.A.delete(`${r}/${t}`);return e.data}catch(e){throw console.error("Error eliminando producto:",e),e}},d=async()=>{try{const t=await o.A.get(r);return t.data}catch(t){throw console.error("Error al obtener productos:",t),t}},l=async t=>{try{const e=await o.A.get(`${r}/buscar`,{params:{nombre:t}});return e.data}catch(e){throw console.error(`Error al obtener productos by nombre like ${t}:`,e),e}}}}]);
//# sourceMappingURL=509.0a4c2af2.js.map